# Template module.yaml. Maintenance assigns numeric module_id and rewrites placeholders.
module:
  id: "__MODULE_ID__"                 # replaced with 3-digit numeric id, e.g. "002"
  name: "google_search_pages"
  version: "1.0.1"
  entrypoint: "google_search_pages:run_module___MODULE_ID__"  # rewritten to run_module_002
  description: "Google Custom Search (web/pages only) source collector."

secrets:
  # Maintenance rewrites env names to "<ID>_GOOGLE_SEARCH_API_KEY" and "<ID>_GOOGLE_SEARCH_ENGINE_ID"
  api_key_env: "__MODULE_ID___GOOGLE_SEARCH_API_KEY"
  engine_id_env: "__MODULE_ID___GOOGLE_SEARCH_ENGINE_ID"

behavior:
  non_image_only: true
  results_per_page_fixed: 10
  start_index_fixed: 1
  max_results_per_query_cap: 100
  max_queries_per_run_cap: 5
  dedupe_default_on: true
  safe_default: "active"

# Pricing is required for billing + UI.
# Recommended model for this module: charge per Google API call (each page fetch is 1 call).
pricing:
  unit: "api_call"            # enum: api_call | result | run
  credits: 1                  # integer credits per unit
  scope: "per_call"           # enum: per_call | per_result | per_run
  note: "Each Google CSE request (page fetch) costs 1 credit."

# Error reasons are required for the platform error table.
# Helper will register these into platform/errors/error_reasons.csv (or discovered table).
errors:
  - code: "MISSING_SECRET"
    severity: "ERROR"
    description: "Required environment secrets are missing for this module."
    remediation: "Add <ID>_GOOGLE_SEARCH_API_KEY and <ID>_GOOGLE_SEARCH_ENGINE_ID as repository secrets and pass them to env in the workflow."
  - code: "INVALID_INPUT"
    severity: "ERROR"
    description: "Work Order inputs are invalid (queries missing/too many, invalid safe value, etc.)."
    remediation: "Validate module inputs against tenant_params.schema.json and ensure Work Order includes modules.<ID>.inputs with required fields."
  - code: "HTTP_RETRY_EXHAUSTED"
    severity: "ERROR"
    description: "Google API request failed after retries (rate limits or transient errors)."
    remediation: "Reduce query volume, add backoff, verify quota, and retry later."
  - code: "OUTPUT_WRITE_FAILED"
    severity: "ERROR"
    description: "Module could not write output artifacts (results/report/raw)."
    remediation: "Verify filesystem permissions and that runtime output directories exist."

# Requirements for installation/runtime validation.
# Helper will register these into platform/modules/requirements.csv (or discovered table).
requirements:
  - type: "secret"
    key: "GOOGLE_SEARCH_API_KEY"
    value: "required"
    note: "Provided via <ID>_GOOGLE_SEARCH_API_KEY"
  - type: "secret"
    key: "GOOGLE_SEARCH_ENGINE_ID"
    value: "required"
    note: "Provided via <ID>_GOOGLE_SEARCH_ENGINE_ID"
  - type: "python_package"
    key: "requests"
    value: "required"
    note: "HTTP client for Google API"
  - type: "output"
    key: "results.jsonl"
    value: "required"
    note: "Normalized search results"
  - type: "output"
    key: "report.json"
    value: "required"
    note: "Run report including dedupe + per-query stats"

outputs:
  base_dir: "outputs/{topic_id}/__MODULE_ID___google_search_pages"
  raw_dir: "outputs/{topic_id}/__MODULE_ID___google_search_pages/raw"
  results_jsonl: "outputs/{topic_id}/__MODULE_ID___google_search_pages/results.jsonl"
  report_json: "outputs/{topic_id}/__MODULE_ID___google_search_pages/report.json"
