name: Orchestrator

on:
  workflow_dispatch:
    inputs:
      work_order_id:
        description: "Work Order ID (platform workorder id)"
        required: true
        type: string

permissions:
  contents: read

jobs:
  orchestrate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Bootstrap billing state from release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          python scripts/bootstrap_billing_state_from_release.py \
            --repo "${{ github.repository }}" \
            --billing-state-dir ".billing-state"

      - name: Run orchestrator
        run: |
          set -euo pipefail
          python -m platform.cli orchestrator \
            --work-order-id "${{ inputs.work_order_id }}"

# AUTOGENERATED:PLATFORM_WORKORDERS:BEGIN
- "PlatDb0T"
- "PlatEm0T"
- "PlatWn0V"
# AUTOGENERATED:PLATFORM_WORKORDERS:END
